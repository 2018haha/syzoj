<% this.title = '重设密码' %>
<% include header %>
<div class="ui error message" id="error" hidden></div>
<div class="ui middle aligned center aligned grid">
  <div class="row">
    <div class="column" style="max-width: 450px">
      <h2 class="ui image header">
        <div class="content">
          重设密码
        </div>
      </h2>
      <form class="ui large form">
        <div class="ui existing segment">
            <div class="two fields">
                <div class="field">
                <label class="ui header">密码</label>
                    <input type="password" placeholder="" id="password1">
                </div>
                <div class="field">
                    <label class="ui header">确认密码</label>
                    <input type="password" placeholder="" id="password2">
                </div>
            </div>
            <div class="ui fluid large submit button" id="reset">重设</div>
        </div>
      </form>
    </div>
  </div>
</div>
<script src="/libs/blueimp-md5/js/md5.min.js"></script>
<script type="text/javascript">
function showMessage(mclass, content) {
    $("#msgBox").addClass(mclass);
    $("#msgContent").text(content);
    $("#msgBox").show();
}
function submitForm() {
    if ($("#password1").val() != $("#password2").val()) {
        showMessage("两次输入的密码不一致");
        return;
    }
    password = md5($("#password1").val() + "syzoj2_xxx");
    $("#resetPassword").addClass("loading");
    $.ajax({
        url: "/api/reset_password",
        type: 'POST',
        data: {
            "token": <%- JSON.stringify(token) %>,
            "password": password
        },
        async: true,
        success: function(data) {
            error_code = data.error_code;
            switch (error_code) {
                case 1:
                    showMessage("positive", "密码重置成功。");
                    return;
                default:
                    showMessage("error", "未知错误" + error_code);
                    break;
            }
            $("#resetPassword").removeClass("loading");
        },
        error:  function(XMLHttpRequest, textStatus, errorThrown) {
            alert(XMLHttpRequest.responseText);
        }
    });
}
$(document).ready(function() {
    $("#reset").click(function() {
        submitForm();
    });
});
</script>